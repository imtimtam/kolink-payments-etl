# CMS Open Payments ETL

This is an ETL for ingesting, cleaning and unifying CMS Open Payments for General and Research yearly payments. Built with Python, Pandas, and simple file-based workflows during an internship dedicated towards an MVP about linking key opinion leaders.

## Features

- Loads CMS General + Research payments per year

- Cleans and normalizes all fields

- Drops invalid rows and removes duplicates

- Adds a standardized `transaction_type` column

- Merges datasets into a unified table per year

- Logs runtime per file

- Outputs cleaned CSV files ready for downstream analysis

## Project Structure

kolink-payments-etl/
├── data/
│   ├── general_payments/           # Raw download location for general payment CSVs to be cleaned and merged
│   │   └── cms_general_2023.csv
│   └── research_payments/          # Raw download location for research payment CSVs to be cleaned and merged
│   │   └── cms_research_2023.csv   
├── exports/
│   └── cms_unified_2023.csv        # Sample output (generated by pipeline)
├── notebook/
│   ├── cleaning.ipynb              # Improved cleaning workflow compared to initial_cleaning_run.ipynb
│   └── result_testing.ipynb        # Exploratory analysis / testing cleaned results
├── utils/
│   └── utils_cms.py                # Functions for loading & cleaning CMS data
├── main.py                         # Runs the ETL pipeline for all years
├── requirements.txt
└── README.md

## Cleaning Rules
- Convert all column names to lowercase
- Validate and clean fields
- Drop rows missing:
    - `covered_recipient_profile_id`
    - `date_of_payment`
    - `total_amount_of_payment_usdollars`
- Remove duplicate rows
- Standardize data types
- Align columns between General and Research datasets

## Additional Logic
- Filter general payments with unrelated payment natures
- Add source transaction_type = `"general"` or `"research"`

## Running the Pipeline
The ETL pipeline is executed via the main script:
        python main.py

The script automatically reads the CMS general and research payment files for the variable years in main. Paths are set internally in the script.

Processed and cleaned data is joined and exported to the exports/ folder in a yearly file.

## Technologies
- Python 3.10+
- pandas
- pathlib

## License

This project is licensed under the MIT License.

## Sources

- **Data** – Open Payments - [https://openpaymentsdata.cms.gov/datasets](https://openpaymentsdata.cms.gov/datasets)